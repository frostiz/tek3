!function(){"use strict";var t={setPId:function(t){this._pid=t},setPStorage:function(t){this._pstorage=t},setPState:function(t,e){var r=this;if(void 0===this._pid)throw new Error("You must explicitly set the component's persistent id");if(!this._pstorage||"function"!=typeof this._pstorage.set)throw new Error("Set storage befor using setPState");var o=this.state;this.setState(t,function(){var i,s={};for(i in o)s[i]=o[i];for(i in t)s[i]=t[i];r._pstorage.set(r._pid,s).then(function(){"function"==typeof e&&e.apply(arguments,this)},function(t){r.setState(o,function(){throw t})})})},removePState:function(){if(void 0===this._pid)throw new Error("You must explicitly set the component's persistent id");return this._pstorage.remove(this._pid)},restorePState:function(t){if(void 0===this._pid)throw new Error("You must explicitly set the component's persistent id");var e=this;return this._pstorage.get(this._pid).then(function(r){return e.setState(r,t),r})},localStorage:{set:function(t,e){try{localStorage.setItem(t,JSON.stringify(e))}catch(r){return Promise.reject(r)}return Promise.resolve(e)},get:function(t){var e;try{e=JSON.parse(localStorage.getItem(t)||"{}")}catch(r){console.warn("Can't parse the current state.")}return Promise.resolve(e)},remove:function(t){return localStorage.removeItem(t),Promise.resolve(t)}}};"undefined"!=typeof module&&module.exports&&(module.exports.ReactPersistentState=t),"undefined"!=typeof window&&(window.ReactPersistentState=t)}();